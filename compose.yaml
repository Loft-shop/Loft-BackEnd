services:
    apigateway:
      build:
        context: .
        dockerfile: src/ApiGateway/Dockerfile
      container_name: apigateway
      ports:
        - "5000:8080"
    
    cartservice:
      build:
        context: .
        dockerfile: src/CartService/Dockerfile
      container_name: cartservice
    
    categoryservice:
      build:
        context: .
        dockerfile: src/CategoryService/Dockerfile
      container_name: categoryservice
    
    orderservice:
      build:
        context: .
        dockerfile: src/OrderService/Dockerfile
      container_name: orderservice
    
    paymentservice:
      build:
        context: .
        dockerfile: src/PaymentService/Dockerfile
      container_name: paymentservice
    
    productservice:
      build:
        context: .
        dockerfile: src/ProductService/Dockerfile
      container_name: productservice

    shippingaddressservice:
      build:
        context: .
        dockerfile: src/ShippingAddressService/Dockerfile
      container_name: shippingaddressservice
    
    userservice:
      build:
        context: .
        dockerfile: src/UserService/Dockerfile
      container_name: userservice
      environment:
        ConnectionStrings__DefaultConnection: Server=postgres;Port=5432;Database=test_loft_shop;User Id=developer;Password=${DB_PASSWORD}
        ASPNETCORE_URLS: http://0.0.0.0:8080
        Jwt__Key: ReplaceThisWithASecretKeyForDevOnlyChangeMe
        Jwt__Issuer: LoftUserService
        Jwt__Audience: LoftUsers
        Jwt__ExpireMinutes: "60"
      depends_on:
        - postgres

    postgres:
      image: postgres:latest
      container_name: postgres
      environment:
        POSTGRES_USER: developer
        POSTGRES_PASSWORD: ${DB_PASSWORD}
        POSTGRES_DB: test_loft_shop
      ports:
        - "5432:5432"
      volumes:
        - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
