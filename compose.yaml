services:
    apigateway:
      build:
        context: .
        dockerfile: src/ApiGateway/Dockerfile
      container_name: apigateway
      ports:
        - "5000:8080"
    
    cartservice:
      build:
        context: .
        dockerfile: src/CartService/Dockerfile
      container_name: cartservice
      ports:
        - "5001:8080"
    
    categoryservice:
      build:
        context: .
        dockerfile: src/CategoryService/Dockerfile
      container_name: categoryservice
      ports:
        - "5002:8080"
    
    orderservice:
      build:
        context: .
        dockerfile: src/OrderService/Dockerfile
      container_name: orderservice
      ports:
        - "5003:8080"
      volumes:
        - ./data:/app/data
      environment:
        ConnectionStrings__DefaultConnection: Server=postgres;Port=5432;Database=test_loft_shop;User Id=developer;Password=${DB_PASSWORD}
        ASPNETCORE_URLS: http://0.0.0.0:8080
        Services__CartService: http://cartservice:8080
        Services__ProductService: http://productservice:8080
        Services__UserService: http://userservice:8080
      depends_on:
        - postgres
        - cartservice
        - productservice
        - userservice
            
    
    paymentservice:
      build:
        context: .
        dockerfile: src/PaymentService/Dockerfile
      container_name: paymentservice
      ports:
        - "5004:8080"
    
    productservice:
      build:
        context: .
        dockerfile: src/ProductService/Dockerfile
      container_name: productservice
      ports:
        - "5005:8080"

    shippingaddressservice:
      build:
        context: .
        dockerfile: src/ShippingAddressService/Dockerfile
      container_name: shippingaddressservice
      ports:
        - "5007:8080"
    
    userservice:
      build:
        context: .
        dockerfile: src/UserService/Dockerfile
      container_name: userservice
      ports:
        - "5008:8080"

    postgres:
      image: postgres:latest
      container_name: postgres
      environment:
        POSTGRES_USER: developer
        POSTGRES_PASSWORD: ${DB_PASSWORD}
        POSTGRES_DB: test_loft_shop
      ports:
        - "5432:5432"
      volumes:
        - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
