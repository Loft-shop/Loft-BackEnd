# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–ª–æ—è.

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

- [ ] –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ SSH
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker (`docker --version`)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker Compose (`docker compose version`)
- [ ] –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `/opt/loft-backend`)
- [ ] –û—Ç–∫—Ä—ã—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã (22, 5000)

**–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `scripts/setup-server.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo

## SSH –∫–ª—é—á

- [ ] –°–æ–∑–¥–∞–Ω SSH –∫–ª—é—á –¥–ª—è –¥–µ–ø–ª–æ—è
  ```bash
  ssh-keygen -t ed25519 -C "github-deploy" -f ~/.ssh/github_deploy
  ```
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  ```bash
  ssh-copy-id -i ~/.ssh/github_deploy.pub username@server-ip
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  ```bash
  ssh -i ~/.ssh/github_deploy username@server-ip
  ```

## GitHub Secrets

–û—Ç–∫—Ä–æ–π—Ç–µ: `Settings ‚Üí Secrets and variables ‚Üí Actions`

### –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–µ–ø–ª–æ—è (deploy.yml):
- [ ] `SSH_PRIVATE_KEY` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/github_deploy`
- [ ] `SERVER_HOST` - IP –∏–ª–∏ –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123.45.67.89`)
- [ ] `SERVER_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH (–Ω–∞–ø—Ä–∏–º–µ—Ä: `ubuntu`)
- [ ] `DEPLOY_PATH` - –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `/opt/loft-backend`)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è Docker Hub (deploy-with-registry.yml):
- [ ] `DOCKER_USERNAME` - username –Ω–∞ Docker Hub
- [ ] `DOCKER_PASSWORD` - –ø–∞—Ä–æ–ª—å –∏–ª–∏ —Ç–æ–∫–µ–Ω

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.env` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
  ```bash
  cd /opt/loft-backend
  nano .env
  ```
  –ú–∏–Ω–∏–º—É–º:
  - `POSTGRES_PASSWORD`
  - `DOCKER_USERNAME` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker Hub)

## –í—ã–±–æ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞

–í—ã–±–µ—Ä–∏—Ç–µ –û–î–ò–ù –∏–∑ –¥–≤—É—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤:

- [ ] **–í–∞—Ä–∏–∞–Ω—Ç 1:** –û—Å—Ç–∞–≤–∏—Ç—å `deploy.yml` (–ø—Ä–æ—Å—Ç–æ–π)
- [ ] **–í–∞—Ä–∏–∞–Ω—Ç 2:** –û—Å—Ç–∞–≤–∏—Ç—å `deploy-with-registry.yml` (—Å Docker Hub)
  
–í—Ç–æ—Ä–æ–π –ø–∞–π–ø–ª–∞–π–Ω –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –¥–æ–±–∞–≤–∏–≤ `.disabled` –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞

## –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git
  ```bash
  git add .
  git commit -m "Setup CI/CD pipeline"
  ```
- [ ] –ö–æ–¥ –∑–∞–ø—É—à–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
  ```bash
  git push origin main
  ```
- [ ] –û—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ Actions –Ω–∞ GitHub
- [ ] –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–ø—É—â–µ–Ω –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:

- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
  ```bash
  ssh username@server-ip
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  ```bash
  cd /opt/loft-backend
  docker compose ps
  ```
- [ ] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "Up"
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
  ```bash
  docker compose logs --tail=50
  ```
- [ ] API Gateway –æ—Ç–≤–µ—á–∞–µ—Ç
  ```bash
  curl http://localhost:5000
  ```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –°–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∫–æ–¥–µ
- [ ] –ó–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS (nginx + Let's Encrypt)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (ELK/Loki)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ (Telegram/Slack)

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart apigateway

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
docker compose down && docker compose up -d

# –û—á–∏—Å—Ç–∫–∞
docker system prune -a --volumes
```

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å Actions
gh run list

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
gh run view --log
```

## –ü—Ä–æ–±–ª–µ–º—ã?

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker compose logs`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞: `ping server-ip`
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
6. üìñ –ß–∏—Ç–∞–π—Ç–µ –ø–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: `.github/DEPLOYMENT.md`

