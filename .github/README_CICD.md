# CI/CD Setup - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–µ–ø–ª–æ—è

–Ø —Å–æ–∑–¥–∞–ª –¥–ª—è –≤–∞—Å **–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞** –ø–∞–π–ø–ª–∞–π–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –±–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:

### üöÄ –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π (deploy.yml)
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞**

- –ö–æ–¥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH
- Docker –æ–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –Ω–∞ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–æ—â–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

**–ú–∏–Ω—É—Å—ã:** –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —Å–±–æ—Ä–∫–∏

### üê≥ –í–∞—Ä–∏–∞–Ω—Ç 2: –° Docker Registry (deploy-with-registry.yml)
**–î–ª—è production –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è**

- Docker –æ–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ GitHub Actions
- –û–±—Ä–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Docker Hub
- –°–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã

**–ü–ª—é—Å—ã:** –ë—ã—Å—Ç—Ä–µ–µ –¥–µ–ø–ª–æ–π, –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1 (–ü—Ä–æ—Å—Ç–æ–π):

1. **–°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á:**
```bash
ssh-keygen -t ed25519 -C "github-deploy" -f ~/.ssh/github_deploy
```

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
```bash
ssh-copy-id -i ~/.ssh/github_deploy.pub username@your-server-ip
```

3. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:**
   - `Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret`
   
   –î–æ–±–∞–≤—å—Ç–µ:
   - `SSH_PRIVATE_KEY` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `~/.ssh/github_deploy`
   - `SERVER_HOST` - IP –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123.45.67.89`)
   - `SERVER_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH (–Ω–∞–ø—Ä–∏–º–µ—Ä: `ubuntu`)
   - `DEPLOY_PATH` - –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `/home/ubuntu/loft-backend`)

4. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:**
```bash
mkdir -p /home/ubuntu/loft-backend
```

5. **–û—Ç–∫–ª—é—á–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –ø–∞–π–ø–ª–∞–π–Ω (–≤—Ä–µ–º–µ–Ω–Ω–æ):**
   - –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ `deploy-with-registry.yml` –≤ `deploy-with-registry.yml.disabled`

6. **–ü—É—à—å—Ç–µ –∫–æ–¥:**
```bash
git add .
git commit -m "Setup CI/CD"
git push origin main
```

### –î–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ 2 (–° Docker Hub):

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ Docker Hub:** https://hub.docker.com

2. **–°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á** (–∫–∞–∫ –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ 1)

3. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:**
   –í—Å–µ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1, –ø–ª—é—Å:
   - `DOCKER_USERNAME` - –≤–∞—à username –Ω–∞ Docker Hub
   - `DOCKER_PASSWORD` - –ø–∞—Ä–æ–ª—å –∏–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç Docker Hub

4. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
mkdir -p /home/ubuntu/loft-backend
cd /home/ubuntu/loft-backend

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã
scp compose.production.yaml your-server:/home/ubuntu/loft-backend/compose.yaml
scp .env.production.example your-server:/home/ubuntu/loft-backend/.env

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
nano .env
```

5. **–û—Ç–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω:**
   - –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ `deploy.yml` –≤ `deploy.yml.disabled`

6. **–ü—É—à—å—Ç–µ –∫–æ–¥**

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –ø—É—à–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É **Actions** –≤ GitHub
2. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
ssh username@server-ip
docker ps
curl http://localhost:5000/health  # –µ—Å–ª–∏ –µ—Å—Ç—å health endpoint
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

- üìñ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `.github/DEPLOYMENT.md`
- üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è nginx + Let's Encrypt)
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `docker compose logs`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

